#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Load NVM and ensure Node.js version is 20 or higher
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"

# Use Node 20 if installed, else error
REQUIRED_MAJOR=20
CURRENT_MAJOR=$(node -v | sed 's/v\([0-9]*\).*/\1/')

if [ "$CURRENT_MAJOR" -lt "$REQUIRED_MAJOR" ]; then
  echo "‚ùå Node.js version $REQUIRED_MAJOR+ is required. Current version: $(node -v)"
  echo "üëâ Please run 'nvm install 20' and try again."
  exit 1
fi

echo "‚úÖ Node.js version $(node -v) meets requirement."

# Run checks
npm test
npm run format
npm run lint

# Stage any formatting/lint fixes
git add .
